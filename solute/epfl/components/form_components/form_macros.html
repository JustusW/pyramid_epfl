{% macro register_field_js(cid) %}
    <script>
		function get_typeahead(cid, query, process) {
			// TODO: fire event and query results from server
			return ['Amsterdam', 'Washington', 'Sydney', 'Beijing', 'Cairo'];
		}

        var selector = "#{{cid}}";
        var type = $(selector).closest("div").attr('epfl-type');

        if (type == "defaultinput" || type == "textarea" || type == "select") {
            $(selector).change(function () {
                epfl.repeat_enqueue(epfl.make_component_event("{{ cid }}", 'change', {value: $(this).val()}), "{{ cid }}");
            });
            
            provide_typeahead = $(selector).data("provide");
            if (provide_typeahead == "typeahead") {
            	$(selector).typeahead({
            		source: function (query, process) {
            			return process(get_typeahead("{cid}}", query));
					}
				});
			}

        } else if (type == "checkbox") {
            $(selector).attr('checked', $("#{{cid}}").val() == 'True');
            $(selector).change(function () {
                var val = val = $(this).is(':checked');
                epfl.repeat_enqueue(epfl.make_component_event("{{ cid }}", 'change', {value: val}), "{{ cid }}");
            });

        } else if (type == "toggle") {
            $(selector).attr('checked', $("#{{cid}}").val() == 'True');
            $(selector).bootstrapSwitch('state');
                $(selector).on('switchChange.bootstrapSwitch', function(event, state) {
                    var val = $(this).closest("div").parent().hasClass("bootstrap-switch-on");
                    epfl.repeat_enqueue(epfl.make_component_event("{{ cid }}", 'change', {value: val}), "{{ cid }}");
                });

        } else if (type == "radiobuttongroup") {
            selector = "input[type=radio][name={{ cid }}]";
            $(selector).change(function () {
                var val = val = $(this).is(':checked');
                epfl.repeat_enqueue(epfl.make_component_event("{{ cid }}", 'change', {value: val}), "{{ cid }}");
            });

        } else if (type == "buttonsetgroup") {
            selector = "input[type=radio][name={{ cid }}]";
            $(selector).change(function () {
                var val = val = $(this).is(':checked');
                var parent = $(this).parent().parent();
                $(parent).find("label").removeClass("active");
                $(this).parent().addClass("active");
                epfl.repeat_enqueue(epfl.make_component_event("{{ cid }}", 'change', {value: val}), "{{ cid }}");
            });

        }

    </script>
{% endmacro %}